# NERO: ニューロンレベルの関連性を用いた説明可能なOOD検出

**発言稿:** 皆さんこんにちは。本日は「NERO: ニューロンレベルの関連性を用いた説明可能なOOD検出」に関する論文をご紹介します。この論文は医療画像処理分野での深層学習モデルの信頼性向上を目的としています。深層学習モデルは通常、訓練データと同じ分布にある前提（閉世界仮定）で学習されますが、実際の診断場面では訓練時に見たことのない異常（分布外データ）が入力される可能性があります。例えば、一般的な胃腸疾患で学習したモデルが、稀な疾患（青ゴムブレブ母斑症やGISTなど）に遭遇すると高い確信度で誤分類する恐れがあります。そこで本研究では、特徴層（ペナルティ層）の各ニューロンの「関連度（リレバンス）」に着目した新しいOOD検出手法NEROを提案しています。まずは背景と問題点を整理し、その後NEROの手法概要と実験結果をご説明します。

## 従来のOOD検出手法

* **ロジット（出力層）ベース手法:** Softmax確率（MSP）やエネルギースコア、温度スケーリングやODIN手法
* **特徴空間ベース手法:** ペナルティ層の特徴量に対するMahalanobis距離、Activation RectificationやReAct法など
* **勾配ベース手法:** 出力確率と一様分布のKL発散に基づくGradNorm法
* しかし、近年の研究ではこれら従来手法だけではOODサンプルの多様なパターンを十分に捉えられない可能性が指摘されています。

**発言稿:** 従来のOOD検出研究では、大きく三つのアプローチが検討されています。一つ目はSoftmax確率やエネルギー値を用いるロジットベースの手法です。二つ目はペナルティ層の特徴表現を利用する手法で、Mahalanobis距離やReAct法などが知られています。三つ目は出力層の勾配情報を用いるGradNorm法などです。しかしこれらの手法だけでは、多様なOODサンプルの振る舞いを十分に反映しきれないとの指摘があります。そこで本論文では、従来と異なる視点である「ニューロンレベルの関連性」に着目しました。

## 提案手法 NERO の概要

* **ニューロン関連性の活用:** ペナルティ層の各ニューロンが予測にどれだけ寄与したかを示す関連度スコアを計算
* **クラスごとの関連性クラスタリング:** 訓練データ各クラスの関連度ベクトルをクラスタリングし、代表的なセントロイドを算出
* **関連度距離によるOODスコア:** 新規サンプルの関連度ベクトルと最も近いクラスセントロイドとの距離を計算し、バイアス項の関連度も加味してOODスコアを定義
* **スコア計算式:** $S(x)=\min_{c} \|\hat r(x)P_r - \mu_c\| + \lambda |r_\beta(x)|$ （さらに関連度の低いニューロンの特徴量ノルムをスケール項として掛け合わせる）
* **説明可能性:** CRP等によるニューロン関連度マップで、IDとOODサンプルに対する注目領域を可視化できる

図1はNEROの手法概要を示しています。入力画像はCNNで特徴ベクトルに変換された後(a)、ペナルティ層の各ニューロンに対する関連度$r_j$を計算します(b)。次に、訓練データの各クラスごとにこれら関連度ベクトルを集計しクラスセントロイド$\mu_c$を求めます(c)。最後に、新規サンプルの関連度パターンと各クラスセントロイドとの距離を計算し、絶対値バイアス関連度項を加えた値をOODスコアとします(d)。
**発言稿:** NEROの鍵は「ニューロン関連性」にあります。図の(a)-(d)の流れで示すように、まず特徴層の出力$a$を得て各ニューロンの関連度$r_j$を計算します。次に、訓練時の各IDクラスに対してニューロン関連度ベクトルをクラスタリングし、代表的なセントロイド$\mu_c$を算出します。新規サンプルでは、この関連度パターンと最も近いクラスセントロイドとの距離を求め、さらにバイアスニューロンの関連度を加えた値をOODスコアとします。加えて、重要度の低いニューロンの特徴量ノルムを掛け合わせることで、正常サンプルと異常サンプルの分離性能を向上させています。このようにNEROは、ニューラルネットワーク内部でどのニューロンが予測に寄与したかを捉えることで、説明可能なOOD検出を実現しています。

## 実験設定と結果

* **データセット:** Kvasir-v2 (消化管内視鏡画像、8クラス・8000枚)、GastroVision (27クラス・8000枚)
* **モデル:** CNN(ResNet-18)およびトランスフォーマ(ViT/DeiT)の2種
* **評価指標:** AUROC（高いほど良い）、FPR95（偽陽性率@95% TPR、低いほど良い）
* **定量結果:** NEROは主要ベンチマークで最高の性能を達成

  * Kvasir-v2: FPR95がResNet18で28.84%、DeiTで18.96%と最良、AUROCも上位（90%以上）
  * GastroVision: DeiTで最良、ResNet18でも2位の性能

**発言稿:** 表1に示すように、NEROは従来手法に比べ非常に高いOOD検出性能を示しました。特にKvasir-v2では、ResNet-18でのFPR95が28.84%、DeiTで18.96%と、すべての比較手法を上回りました。AUROCも90%を超えており、False Positiveを抑えつつ検出率を高めています。GastroVisionでもDeiTモデルで最高性能を達成し、ResNet-18でも第2位に入りました。これらの結果から、NEROは異なるモデル・データセットでも一貫して優れた性能を発揮することが確認されました。

## 説明可能性の検証

* **属性マップ生成:** IDサンプルとOODサンプルに対する関連度マップ(CRP)を可視化
* **視覚的な違い:** IDサンプルでは特定の領域に高い関連度が集中する一方、OODでは関連度パターンが拡散的
* **平均関連度プロット:** IDとOOD間でチャネル毎の関連度分布に明確な差異（図3）
* **信頼性と解釈性:** どのニューロンや領域が判断に寄与したかが直感的に把握可能

図3は、NEROによる説明可能性分析の例です。左側は病変（ID）画像、右側は別クラスの病変（OOD）画像を示し、それぞれ上段に関連度マップを表示しています。ID画像では特定領域に強い高関連度が見られますが、OOD画像では関連度が広く散在しています。下段のプロットは各チャネルの平均関連度を示し、IDとOODで顕著な差異が確認できます。
**発言稿:** さらにNEROの解釈性を確認するため、Concept Relevance Propagation (CRP) による属性マップを可視化しました。図3に示すように、IDサンプルでは特定のニューロン（特徴）が強く反応しているのに対し、OODサンプルでは関連度分布に違いが見られます。これにより、どのニューロンがモデルの予測に影響を与えたかが直感的にわかり、モデルの判断根拠を理解できます。

## 結論と貢献

* NERO: **ポストホック**で**説明可能な**OOD検出手法を新提案
* ニューロンレベルの関連性を利用し、各クラス毎の代表的パターンとの距離でスコアリング
* 医療画像ベンチマークで従来手法を上回る性能を実証
* モデルの信頼性向上に加え、関連性マップによる解釈性向上も達成

**発言稿:** まとめます。本研究は、ニューラルネットワーク内部のニューロン関連性を活用することで、OOD検出における新たな指標「NERO」を提案しました。NEROは再学習不要の事後解析手法でありながら、実際の医療画像データ上で従来の最先端手法を上回る性能を示しました。さらに関連性マップを生成することで、異常サンプルの検出根拠を可視化でき、診断支援の解釈性も大きく向上します。今後は他分野やさらなる検証を通じて、より信頼性の高いAI診断支援への応用を目指したいと考えています。

**参考文献:** Chhetri et al., “NERO: Explainable Out-of-Distribution Detection with Neuron-level Relevance”。論文では詳細な手法定義と実験結果が掲載されています。
